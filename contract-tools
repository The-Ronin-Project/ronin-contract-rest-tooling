#!/usr/bin/env bash

case $1 in

    test)
        spectral lint --fail-severity=warn --ruleset /etc/contract-tools-config/spectral.yaml $(find . -regex '.*v[0-9]*/.*\.api\.json')
        ;;

    doc)
        echo "Generating documentation for all versions"
        find . -regex '.*v[0-9]*/.*\.api\.json' -exec bash -c "openapi-generator-cli generate -i '{}' -g html2 -o \$(dirname '{}')/docs" \;
        rm openapitools.json
        ;;

    clean)
        echo "Cleaning generated files"
        find . -depth -type d -name 'docs' -exec rm -rf "{}" \;
        ;;

    *)
        echo "Unknown command '$1'" >&2
        echo "Usage: contract-tools [test|doc|clean]" >&2
        ;;
esac
